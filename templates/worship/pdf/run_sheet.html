<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Fiche de déroulement - {{ service.event.start_date|date:"d/m/Y" }}</title>
    <style>
        @page {
            size: A4 portrait;
            margin: 12mm;
        }
        
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        :root {
            --accent: #0A36FF;
            --black: #0f0f0f;
            --gray-500: #737373;
            --gray-300: #d4d4d4;
            --gray-100: #f5f5f5;
        }
        
        body {
            font-family: 'Helvetica Neue', Arial, sans-serif;
            font-size: 10pt;
            color: var(--black);
            line-height: 1.4;
        }
        
        /* En-tête */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            border-bottom: 3px solid var(--black);
            padding-bottom: 4mm;
            margin-bottom: 6mm;
        }
        
        .header-left h1 {
            font-size: 18pt;
            font-weight: 700;
            margin-bottom: 2mm;
        }
        
        .header-left .subtitle {
            font-size: 11pt;
            color: var(--gray-500);
        }
        
        .header-right {
            text-align: right;
        }
        
        .header-right .date {
            font-size: 14pt;
            font-weight: 700;
            color: var(--accent);
        }
        
        .header-right .time {
            font-size: 11pt;
            color: var(--gray-500);
        }
        
        /* Section infos */
        .info-section {
            background: var(--gray-100);
            padding: 4mm;
            border-radius: 2mm;
            margin-bottom: 6mm;
        }
        
        .info-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 3mm;
        }
        
        .info-item label {
            font-size: 8pt;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: var(--gray-500);
            display: block;
            margin-bottom: 1mm;
        }
        
        .info-item span {
            font-weight: 600;
        }
        
        /* Section rôles */
        .section-title {
            font-size: 12pt;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
            border-bottom: 2px solid var(--accent);
            padding-bottom: 2mm;
            margin-bottom: 4mm;
            margin-top: 6mm;
        }
        
        .roles-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 3mm;
        }
        
        .role-card {
            background: var(--gray-100);
            padding: 3mm;
            border-left: 3px solid var(--accent);
        }
        
        .role-card .role-name {
            font-size: 8pt;
            text-transform: uppercase;
            color: var(--gray-500);
            margin-bottom: 1mm;
        }
        
        .role-card .person-name {
            font-weight: 600;
            font-size: 10pt;
        }
        
        .role-card .status {
            font-size: 7pt;
            margin-top: 1mm;
        }
        
        .role-card .status.confirmed { color: #16a34a; }
        .role-card .status.pending { color: #d97706; }
        
        /* Programme - Run Sheet */
        .run-sheet {
            width: 100%;
            border-collapse: collapse;
            margin-top: 4mm;
        }
        
        .run-sheet th {
            background: var(--black);
            color: white;
            padding: 3mm;
            text-align: left;
            font-size: 8pt;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .run-sheet td {
            padding: 3mm;
            border-bottom: 1px solid var(--gray-300);
            vertical-align: top;
        }
        
        .run-sheet tr:nth-child(even) td {
            background: var(--gray-100);
        }
        
        .time-cell {
            font-weight: 700;
            color: var(--accent);
            white-space: nowrap;
            width: 15%;
        }
        
        .duration-cell {
            color: var(--gray-500);
            font-size: 9pt;
            width: 10%;
        }
        
        .item-cell {
            width: 25%;
        }
        
        .item-type {
            font-weight: 600;
            text-transform: uppercase;
            font-size: 8pt;
            color: var(--accent);
        }
        
        .item-title {
            font-size: 10pt;
        }
        
        .responsible-cell {
            width: 20%;
            font-size: 9pt;
        }
        
        .notes-cell {
            width: 30%;
            font-size: 8pt;
            color: var(--gray-500);
        }
        
        /* Footer */
        .footer {
            margin-top: 8mm;
            padding-top: 4mm;
            border-top: 1px solid var(--gray-300);
            text-align: center;
            font-size: 8pt;
            color: var(--gray-500);
        }
        
        /* Checkbox pour équipe technique */
        .checkbox {
            display: inline-block;
            width: 4mm;
            height: 4mm;
            border: 1px solid var(--gray-500);
            margin-right: 2mm;
            vertical-align: middle;
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="header-left">
            <h1>Fiche de Déroulement</h1>
            <div class="subtitle">{{ service.get_service_type_display }}</div>
        </div>
        <div class="header-right">
            <div class="date">{{ service.event.start_date|date:"l d F Y" }}</div>
            <div class="time">{% if service.event.start_time %}{{ service.event.start_time|time:"H:i" }}{% endif %}</div>
        </div>
    </div>
    
    {% if service.theme or service.bible_text %}
    <div class="info-section">
        <div class="info-grid">
            {% if service.theme %}
            <div class="info-item">
                <label>Thème</label>
                <span>{{ service.theme }}</span>
            </div>
            {% endif %}
            {% if service.bible_text %}
            <div class="info-item">
                <label>Texte biblique</label>
                <span>{{ service.bible_text }}</span>
            </div>
            {% endif %}
            {% if service.sermon_title %}
            <div class="info-item">
                <label>Prédication</label>
                <span>{{ service.sermon_title }}</span>
            </div>
            {% endif %}
        </div>
    </div>
    {% endif %}
    
    <div class="section-title">Équipe du jour</div>
    <div class="roles-grid">
        {% for role in roles %}
        <div class="role-card">
            <div class="role-name">{{ role.get_role_display }}</div>
            <div class="person-name">{{ role.assignee_name }}</div>
            <div class="status {% if role.status == 'confirme' %}confirmed{% else %}pending{% endif %}">
                <span class="checkbox"></span>
                {{ role.get_status_display }}
            </div>
        </div>
        {% empty %}
        <div class="role-card">
            <div class="person-name">Aucun rôle assigné</div>
        </div>
        {% endfor %}
    </div>
    
    <div class="section-title">Programme minute par minute</div>
    <table class="run-sheet">
        <thead>
            <tr>
                <th>Heure</th>
                <th>Durée</th>
                <th>Segment</th>
                <th>Responsable</th>
                <th>Notes techniques</th>
            </tr>
        </thead>
        <tbody>
            {% for item in plan_items %}
            <tr>
                <td class="time-cell">
                    {% if item.start_time %}{{ item.start_time|time:"H:i" }}{% else %}—{% endif %}
                </td>
                <td class="duration-cell">{{ item.duration_minutes }} min</td>
                <td class="item-cell">
                    <div class="item-type">{{ item.get_item_type_display }}</div>
                    {% if item.title %}<div class="item-title">{{ item.title }}</div>{% endif %}
                </td>
                <td class="responsible-cell">
                    {% if item.responsible %}{{ item.responsible.full_name }}{% else %}—{% endif %}
                </td>
                <td class="notes-cell">
                    {{ item.notes|default:"—" }}
                    {% if item.resources_needed %}<br><em>Ressources: {{ item.resources_needed }}</em>{% endif %}
                </td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="5" style="text-align: center; color: var(--gray-500);">
                    Aucun élément de programme défini
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    
    <div class="footer">
        EEBC · Fiche générée le {% now "d/m/Y à H:i" %} · Usage interne équipe technique
    </div>
</body>
</html>
