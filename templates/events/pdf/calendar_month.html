<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>{{ title }} - EEBC</title>
    <style>
        @page {
            size: A4 landscape;
            margin: 6mm;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, sans-serif;
            font-size: 9pt;
            color: #0B0F19;
        }
        
        /* Chaque mois = 1 page */
        .calendar-page {
            width: 285mm;
            height: 190mm;
            page-break-after: always;
            page-break-inside: avoid;
            overflow: hidden;
        }
        
        .calendar-page:last-child {
            page-break-after: auto;
        }
        
        .page-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-bottom: 4px;
            border-bottom: 2px solid #0A36FF;
            margin-bottom: 4px;
        }
        
        .page-header h1 {
            font-size: 14pt;
            color: #0A36FF;
            font-weight: 700;
        }
        
        .page-header .church {
            font-size: 9pt;
            color: #64748b;
        }
        
        .calendar-table {
            width: 100%;
            border-collapse: collapse;
            table-layout: fixed;
        }
        
        .calendar-table th {
            background: #0A36FF;
            color: white;
            padding: 5px 2px;
            text-align: center;
            font-size: 8pt;
            font-weight: 600;
            text-transform: uppercase;
            border: 1px solid #0A36FF;
        }
        
        .calendar-table td {
            border: 1px solid #e2e8f0;
            vertical-align: top;
            padding: 2px;
            height: {% if mode == 'quarter' %}26mm{% else %}28mm{% endif %};
            background: #fff;
            overflow: hidden;
        }
        
        .calendar-table td.empty {
            background: #f8fafc;
        }
        
        .day-number {
            font-weight: 700;
            font-size: 10pt;
            color: #0B0F19;
            margin-bottom: 1px;
        }
        
        .event-item {
            font-size: 7pt;
            padding: 2px 3px;
            margin-bottom: 1px;
            border-radius: 2px;
            color: white;
            line-height: 1.2;
            overflow: hidden;
        }
        
        .event-time {
            font-weight: 700;
        }
        
        .event-title {
            display: block;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .event-location {
            font-size: 6pt;
            opacity: 0.9;
            display: block;
        }
        
        .more-events {
            font-size: 6pt;
            color: #64748b;
            text-align: center;
        }
        
        .legend {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            padding-top: 3px;
            border-top: 1px solid #e2e8f0;
            margin-top: 2px;
            font-size: 7pt;
            color: #64748b;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 2px;
        }
        
        .legend-color {
            width: 8px;
            height: 8px;
            border-radius: 2px;
        }
        
        /* Mode trimestre */
        {% if mode == 'quarter' %}
        .event-location {
            display: none;
        }
        
        .event-item {
            font-size: 6pt;
            padding: 1px 2px;
        }
        {% endif %}
    </style>
</head>
<body>
    {% for cal in calendars %}
    <div class="calendar-page">
        <div class="page-header">
            <h1>{{ cal.month_name }} {{ cal.year }}</h1>
            <span class="church">EEBC - √âglise √âvang√©lique Baptiste de Cabassou</span>
        </div>
        
        <table class="calendar-table">
            <thead>
                <tr>
                    {% for jour in jours_semaine %}
                    <th>{{ jour }}</th>
                    {% endfor %}
                </tr>
            </thead>
            <tbody>
                {% for week in cal.weeks %}
                <tr>
                    {% for day_data in week %}
                    <td class="{% if not day_data.day %}empty{% endif %}">
                        {% if day_data.day %}
                        <div class="day-number">{{ day_data.day }}</div>
                        <div class="day-events">
                            {% for event in day_data.events|slice:":3" %}
                            <div class="event-item" style="background:{{ event.color }};">
                                <span class="event-time">{% if event.start_time %}{{ event.start_time|time:"H:i" }} {% endif %}</span>
                                <span class="event-title">{{ event.title|truncatechars:16 }}</span>
                                {% if event.location %}
                                <span class="event-location">üìç{{ event.location|truncatechars:12 }}</span>
                                {% endif %}
                            </div>
                            {% endfor %}
                            {% if day_data.events|length > 3 %}
                            <div class="more-events">+{{ day_data.events|length|add:"-3" }}</div>
                            {% endif %}
                        </div>
                        {% endif %}
                    </td>
                    {% endfor %}
                </tr>
                {% endfor %}
            </tbody>
        </table>
        
        <div class="legend">
            {% for category in categories %}
            <div class="legend-item">
                <div class="legend-color" style="background:{{ category.color }};"></div>
                <span>{{ category.name }}</span>
            </div>
            {% endfor %}
            <span style="margin-left:auto;">{% now "d/m/Y" %}</span>
        </div>
    </div>
    {% endfor %}
</body>
</html>
