<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>{{ title }} - EEBC</title>
    <style>
        @page {
            size: 297mm 210mm;
            margin: 0;
        }
        
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'Segoe UI', Arial, sans-serif;
            font-size: 10pt;
            color: #1a1a2e;
        }
        
        /* ========== PAGE 1: COUVERTURE ========== */
        .cover-page {
            width: 297mm;
            height: 210mm;
            background: linear-gradient(145deg, #0A36FF 0%, #1e3a8a 50%, #0f172a 100%);
            position: relative;
            overflow: hidden;
            page-break-after: always;
        }
        
        .cover-pattern {
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            opacity: 0.1;
            background-image: 
                radial-gradient(circle at 15% 85%, rgba(255,255,255,0.4) 0%, transparent 40%),
                radial-gradient(circle at 85% 15%, rgba(255,255,255,0.3) 0%, transparent 35%);
        }
        
        .cover-content {
            position: relative;
            z-index: 10;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            color: white;
        }
        
        .cover-icon { font-size: 70pt; margin-bottom: 12px; }
        .cover-church { font-size: 13pt; letter-spacing: 8px; text-transform: uppercase; opacity: 0.85; margin-bottom: 8px; }
        .cover-title { font-size: 52pt; font-weight: 800; letter-spacing: 4px; margin-bottom: 6px; }
        .cover-subtitle { font-size: 16pt; font-weight: 300; opacity: 0.9; margin-bottom: 30px; }
        .cover-period { background: rgba(255,255,255,0.2); padding: 14px 55px; border-radius: 50px; font-size: 20pt; font-weight: 600; }
        .cover-footer { position: absolute; bottom: 12mm; font-size: 10pt; opacity: 0.6; }
        
        /* ========== PAGES 2-4: CALENDRIER ========== */
        .calendar-page {
            width: 297mm;
            height: 210mm;
            padding: 4mm 6mm;
            page-break-after: always;
            background: white;
        }
        
        .month-header {
            background: linear-gradient(135deg, #0A36FF, #1e3a8a);
            color: white;
            padding: 6px 20px;
            border-radius: 6px;
            margin-bottom: 4px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .month-name { font-size: 22pt; font-weight: 800; }
        .month-year { font-size: 13pt; opacity: 0.9; }
        
        .calendar-grid {
            width: 100%;
            border-collapse: collapse;
            table-layout: fixed;
        }
        
        .calendar-grid th {
            background: linear-gradient(180deg, #1e293b, #334155);
            color: white;
            font-weight: 700;
            font-size: 9pt;
            padding: 6px 2px;
            text-align: center;
            border: 1px solid #1e293b;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .calendar-grid th.weekend { background: linear-gradient(180deg, #b45309, #d97706); }
        
        .calendar-grid td {
            border: 1px solid #94a3b8;
            vertical-align: top;
            padding: 0;
            background: white;
            height: 27mm;
        }
        
        .calendar-grid td.empty { background: #e2e8f0; }
        .calendar-grid td.weekend { background: #fef9c3; }
        
        .day-cell {
            height: 100%;
            width: 100%;
            display: flex;
            flex-direction: column;
        }
        
        .day-num {
            font-size: 11pt;
            font-weight: 800;
            color: #0f172a;
            padding: 2px 4px;
            background: #f1f5f9;
            border-bottom: 1px solid #cbd5e1;
            flex-shrink: 0;
        }
        
        .day-num.sunday { color: #dc2626; background: #fee2e2; }
        
        .events-container {
            flex: 1;
            padding: 2px;
            display: flex;
            flex-direction: column;
            gap: 1px;
            overflow: hidden;
        }
        
        /* √âv√©nement remplit toute la hauteur disponible */
        .evt {
            flex: 1;
            padding: 3px 4px;
            border-radius: 3px;
            color: white;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            justify-content: center;
            box-shadow: 0 1px 2px rgba(0,0,0,0.15);
        }
        
        .evt-title { font-weight: 700; line-height: 1.15; }
        .evt-time { opacity: 0.9; font-weight: 500; }
        .evt-desc { opacity: 0.85; line-height: 1.1; }
        
        /* 1 seul √©v√©nement = GRAND */
        .evt.size-1 { padding: 5px 6px; }
        .evt.size-1 .evt-title { font-size: 10pt; margin-bottom: 2px; }
        .evt.size-1 .evt-time { font-size: 8pt; margin-bottom: 1px; }
        .evt.size-1 .evt-desc { font-size: 7pt; }
        
        /* 2 √©v√©nements */
        .evt.size-2 .evt-title { font-size: 8pt; margin-bottom: 1px; }
        .evt.size-2 .evt-time { font-size: 7pt; }
        .evt.size-2 .evt-desc { display: none; }
        
        /* 3 √©v√©nements */
        .evt.size-3 .evt-title { font-size: 7pt; }
        .evt.size-3 .evt-time { font-size: 6pt; }
        .evt.size-3 .evt-desc { display: none; }
        
        /* 4+ √©v√©nements */
        .evt.size-4 { padding: 1px 3px; flex-direction: row; align-items: center; gap: 2px; }
        .evt.size-4 .evt-title { font-size: 6pt; }
        .evt.size-4 .evt-time { font-size: 5pt; }
        .evt.size-4 .evt-desc { display: none; }
        
        .more-events {
            font-size: 6pt;
            color: #475569;
            text-align: center;
            padding: 1px;
            font-weight: 700;
            background: #e2e8f0;
            border-radius: 2px;
            flex-shrink: 0;
        }
        
        .cal-footer {
            margin-top: 2px;
            text-align: center;
            font-size: 7pt;
            color: #64748b;
        }
        
        /* ========== PAGE 5: SYNTH√àSE ========== */
        .summary-page {
            width: 297mm;
            height: 210mm;
            padding: 6mm 8mm;
            background: white;
        }
        
        .summary-header {
            background: linear-gradient(135deg, #0A36FF, #1e3a8a);
            color: white;
            padding: 10px 20px;
            border-radius: 8px;
            margin-bottom: 8px;
            text-align: center;
        }
        
        .summary-header h2 { font-size: 18pt; font-weight: 700; }
        .summary-header p { font-size: 10pt; opacity: 0.9; margin-top: 2px; }
        
        .summary-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 9pt;
        }
        
        .summary-table th {
            background: linear-gradient(180deg, #1e293b, #334155);
            color: white;
            padding: 8px 10px;
            text-align: left;
            font-weight: 600;
            border: 1px solid #1e293b;
        }
        
        .summary-table td {
            padding: 6px 10px;
            border: 1px solid #cbd5e1;
            vertical-align: middle;
        }
        
        .summary-table tr:nth-child(even) td:not(.cat-cell) { background: #f8fafc; }
        
        .cat-cell {
            font-weight: 700;
            text-align: center;
            vertical-align: middle;
            border-radius: 0;
        }
        
        .cat-cell small { font-weight: 400; opacity: 0.9; font-size: 8pt; }
        
        .date-cell { font-weight: 600; color: #0A36FF; }
        .time-cell { color: #475569; }
        .title-cell { font-weight: 500; color: #1e293b; }
        .location-cell { color: #64748b; font-size: 8pt; }
        
        .summary-footer {
            margin-top: 8px;
            text-align: center;
            font-size: 8pt;
            color: #94a3b8;
            padding-top: 6px;
            border-top: 1px solid #e2e8f0;
        }
    </style>
</head>
<body>
    <!-- PAGE 1: COUVERTURE -->
    <div class="cover-page">
        <div class="cover-pattern"></div>
        <div class="cover-content">
            <div class="cover-icon">üìÖ</div>
            <div class="cover-church">√âglise √âvang√©lique Baptiste de Cabassou</div>
            <div class="cover-title">CALENDRIER</div>
            <div class="cover-subtitle">Programme des activit√©s</div>
            <div class="cover-period">{{ title }}</div>
        </div>
        <div class="cover-footer">EEBC ‚Ä¢ {{ year }}</div>
    </div>
    
    <!-- PAGES 2-4: CALENDRIER MENSUEL -->
    {% for cal in calendars %}
    <div class="calendar-page">
        <div class="month-header">
            <span class="month-name">{{ cal.month_name }}</span>
            <span class="month-year">{{ cal.year }}</span>
        </div>
        
        <table class="calendar-grid">
            <thead>
                <tr>
                    {% for jour in jours_semaine %}
                    <th {% if forloop.counter > 5 %}class="weekend"{% endif %}>{{ jour }}</th>
                    {% endfor %}
                </tr>
            </thead>
            <tbody>
                {% for week in cal.weeks %}
                <tr>
                    {% for day_data in week %}
                    <td class="{% if not day_data.day %}empty{% endif %}{% if forloop.counter > 5 %} weekend{% endif %}">
                        {% if day_data.day %}
                        <div class="day-cell">
                            <div class="day-num {% if forloop.counter == 7 %}sunday{% endif %}">{{ day_data.day }}</div>
                            <div class="events-container">
                                {% with n=day_data.events|length %}
                                {% for event in day_data.events|slice:":4" %}
                                <div class="evt size-{% if n == 1 %}1{% elif n == 2 %}2{% elif n == 3 %}3{% else %}4{% endif %}" style="background:{{ event.category.color|default:'#0A36FF' }}">
                                    <div class="evt-title">{{ event.title|truncatechars:28 }}</div>
                                    {% if event.start_time %}<div class="evt-time">{{ event.start_time|time:"H:i" }}</div>{% endif %}
                                    {% if event.description and n == 1 %}<div class="evt-desc">{{ event.description|truncatechars:45 }}</div>{% endif %}
                                </div>
                                {% endfor %}
                                {% if n > 4 %}<div class="more-events">+{{ n|add:"-4" }}</div>{% endif %}
                                {% endwith %}
                            </div>
                        </div>
                        {% endif %}
                    </td>
                    {% endfor %}
                </tr>
                {% endfor %}
            </tbody>
        </table>
        <div class="cal-footer">EEBC ‚Ä¢ {{ cal.month_name }} {{ cal.year }}</div>
    </div>
    {% endfor %}
    
    <!-- PAGE 5: SYNTH√àSE PAR CAT√âGORIE -->
    <div class="summary-page">
        <div class="summary-header">
            <h2>üìã R√©capitulatif des √©v√©nements</h2>
            <p>{{ title }} ‚Ä¢ {{ total_events }} √©v√©nement{{ total_events|pluralize }}</p>
        </div>
        
        <table class="summary-table">
            <thead>
                <tr>
                    <th style="width:22%">Cat√©gorie</th>
                    <th style="width:12%">Date</th>
                    <th style="width:10%">Heure</th>
                    <th style="width:36%">√âv√©nement</th>
                    <th style="width:20%">Lieu</th>
                </tr>
            </thead>
            <tbody>
                {% for cat_data in events_by_category %}
                {% for event in cat_data.events %}
                <tr>
                    {% if forloop.first %}
                    <td class="cat-cell" rowspan="{{ cat_data.events|length }}" style="background:{{ cat_data.color }}; color:white;">
                        <strong>{{ cat_data.name }}</strong><br>
                        <small>{{ cat_data.events|length }} √©vt.</small>
                    </td>
                    {% endif %}
                    <td class="date-cell">{{ event.start_date|date:"d/m/Y" }}</td>
                    <td class="time-cell">{% if event.start_time %}{{ event.start_time|time:"H:i" }}{% else %}-{% endif %}</td>
                    <td class="title-cell">{{ event.title }}</td>
                    <td class="location-cell">{{ event.location|default:"-" }}</td>
                </tr>
                {% endfor %}
                {% endfor %}
            </tbody>
        </table>
        
        <div class="summary-footer">EEBC - √âglise √âvang√©lique Baptiste de Cabassou ‚Ä¢ {{ title }}</div>
    </div>
</body>
</html>
